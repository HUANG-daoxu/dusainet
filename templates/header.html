{% load staticfiles %}
{% load notifications_tags %}
{% load weibo_utils %}
{% load get_userinfo %}

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <!-- PC导航 -->
    <a class="navbar-brand" href="/" style="font-size: 1.2em;">
        杜赛的个人网站
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">

        <ul class="navbar-nav bd-navbar-nav flex-row">
            <li class="
                nav-item
                {% if 'article' in request.path or request.path == '/' %}
                active
                {% endif %}
                "
            >
                <a class="nav-link" href="/">
                    文章
                </a>
            </li>
            <li class="
                nav-item
                {% if '/course' in request.path %}
                active
                {% endif %}
                "
            >
                <a class="nav-link" href="{% url 'course:course_list' %}">
                    教程
                </a>
            </li>
            <li class="
                nav-item
                {% if '/book' in request.path %}
                active
                {% endif %}
                "
            >
                <a class="nav-link" href="{% url 'readbook:book_list' %}">
                    读书
                </a>
            </li>
            <li class="
                nav-item
                {% if '/album' in request.path %}
                active
                {% endif %}
                "
            >
                <a class="nav-link" href="{% url 'album:album_list' %}">
                    照片墙
                </a>
            </li>
            <li class="
                nav-item
                {% if '/vlog' in request.path %}
                active
                {% endif %}
                "
            >
                <a class="nav-link" href="{% url 'vlog:list' %}">
                    视频
                </a>
            </li>
            <li class="
                nav-item
                {% if '/aboutme' in request.path %}
                active
                {% endif %}
                "
            >
                <a class="nav-link" href="{% url 'aboutme:footpoint' %}">
                    关于
                </a>
            </li>

            <!-- 移动端导航 -->
            {#            <li class="layui-nav-item layui-hide-sm" style="float: right">#}
            {#                <a href="javascript:"><i class="layui-icon layui-icon-spread-left"></i></a>#}
            {#                <dl class="layui-nav-child">#}
            {#                    <!-- 二级菜单 -->#}
            {#                    <dd><a href="/">文章</a></dd>#}
            {#                    <dd><a href="{% url 'course:course_list' %}">教程</a></dd>#}
            {#                    <dd><a href="{% url 'readbook:book_list' %}">读书</a></dd>#}
            {#                    <dd><a href="{% url 'album:album_list' %}">照片墙</a></dd>#}
            {#                    <dd><a href="{% url 'vlog:list' %}">视频</a></dd>#}
            {#                    <dd class="layui-hide-sm"><a href="#" onclick="mobile_search()">搜索</a></dd>#}
            {#                    <dd><a href="{% url 'aboutme:footpoint' %}">关于</a></dd>#}
            {#                </dl>#}
            {#            </li>#}
        </ul>
        <ul class="navbar-nav ml-md-auto" style="margin: -6px 0 -6px 0;">

            <!-- 搜索框 -->
            <form role="search"
                  class="form-inline"
                  method="get"
                  id="searchform"
                  action="{% url 'haystack_search' %}"
            >
                <input style=" background-color: #dddddd"
                       type="search"
                       aria-label="Search"
                       name="q"
                       placeholder="搜索文章.."
                       required
                       class="form-control mr-sm-2"
                >
            </form>
            {#        <li class="layui-nav-item layui-hide-md layui-hide-xs"#}
            {#            style="float: right"#}
            {#        >#}
            {#            <a href="#" onclick="mobile_search()">#}
            {#                <i class="layui-icon layui-icon-search" style="font-weight: bold"></i>#}
            {#            </a>#}
            {#        </li>#}
            {#        </ul>#}


            <!-- 用户下拉条avatar -->
            {% if user.is_authenticated %}
                <li class="nav-item dropdown" style="float: right;">
                    {% get_userinfo user.id as userinfo %}
                    {% if user.socialaccount_set.all.0.get_avatar_url %}
                        <a class="nav-link dropdown-toggle"
                           id="navbarDropdownMenuLink"
                           role="button"
                           data-toggle="dropdown"
                           aria-haspopup="true"
                           aria-expanded="false"
                           href="#"
                        >
                            <img src="{% translate_avatar_ssl user.socialaccount_set.all.0.get_avatar_url %}"
                                 style="max-height: 40px; border-radius: 20%"
                                 alt="头像"
                            >
                        </a>
                    {% elif userinfo.avatar %}
                        {% if 'static' in userinfo.avatar.url %}
                            <a class="nav-link dropdown-toggle"
                               id="navbarDropdownMenuLink"
                               role="button"
                               data-toggle="dropdown"
                               aria-haspopup="true"
                               aria-expanded="false"
                               href="#"
                            >
                                <img src="{{ userinfo.avatar }}"
                                     alt="avatar"
                                     style="max-height: 40px; border-radius: 20%"
                                >
                            </a>
                        {% else %}
                            <a class="nav-link dropdown-toggle"
                               id="navbarDropdownMenuLink"
                               role="button"
                               data-toggle="dropdown"
                               aria-haspopup="true"
                               aria-expanded="false"
                               href="#"
                               style="color: gray;"
                            >
                                <img src="{{ userinfo.avatar.url }}"
                                     alt="avatar"
                                     style="max-height: 40px; border-radius: 20%"
                                >
                            </a>
                        {% endif %}
                    {% else %}
                        {{ user.username }}
                    {% endif %}
                    {% notifications_unread as unread_count %}
                    {% if unread_count %}
                        <span class="layui-badge-dot" style="left: 0; top: 20px;"></span>
                    {% endif %}

                    <!-- 用户下拉条item -->
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                        <a href="{% url 'my_notifications:notify_box' %}"
                           class="dropdown-item"
                        >
                            通知
                            {% if unread_count %}
                                <span class="layui-badge" style="left: 50%;">
                                            {{ unread_count }}
                                        </span>
                            {% endif %}
                        </a>
                        <a href="{% url 'userinfo:detail' %}"
                           class="dropdown-item"
                        >
                            个人信息
                        </a>
                        {% if user.is_superuser %}
                            <a href="{% url 'article:article_create' %}" class="dropdown-item"
                            >
                                写文章
                            </a>
                            <a href="/admin" class="dropdown-item"
                            >
                                后台
                            </a>
                            <a href="{% url 'imagesource:imagesource_list' %}"
                               class="dropdown-item"
                            >
                                图库
                            </a>
                        {% endif %}
                        <a href="{% url 'account_logout' %}"
                           class="dropdown-item"
                        >
                            退出登录
                        </a>
                    </div>
                </li>

            {% else %}
                <li class="layui-nav-item "
                    style="float: right;">
                    <a href="{% url 'account_login' %}">
                        登录
                    </a>
                </li>
            {% endif %}
        </ul>


    </div>


</nav>

<script type="text/javascript">
    //注意：layui导航 依赖 element 模块，否则无法进行功能性操作
    layui.use('element', function () {
        var element = layui.element;

        //…
    });

    function mobile_search() {
        layui.use('layer', function () {
            var layer2 = layui.layer;

            layer2.open({
                title: '搜索文章..',
                type: 1,
                shadeClose: true,
                area: '300px',
                content: '<form role="search" method="get" id="searchform" action="{% url 'haystack_search' %}">\n' +
                '<input style=" background-color: #dddddd" type="search" name="q" placeholder="输入回车确认" required\n' +
                'class="layui-input">\n' +
                '</form>'
            });
        });
    }

</script>